<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link href="https://fonts.googleapis.com/css?family=Lato:100,300,400,700,900" rel="stylesheet">

    
    <link rel="stylesheet" href="css/style.css">
    

    <title>Behavioral Econ Experiment</title>
</head>
<body>
            <section class="section-stories">

   <!--<div class="bg-video" style = "background-image: img/back.jpg;"> -->
    <!--    <img src = "img/back.jpg" alt = "eh" class="bg-video"> -->
           
    <!-- </div> ADD ROUND AT THE TOP -->
    <div class="u-center-text u-margin-bottom-big">
            <h2 id = "rd" class= "heading-secondary">
                Play to Win!
            </h2>
        </div>
        <div class="row">
            <div class="story">
               
            <div class="story__text">
                <h3 class="heading-tertiary u-margin-bottom-small">
                    Instructions
                </h3>
                <p>
                    putem here son
                </p>
            </div>
            </div>

        </div>
        <div class="row">
            <div class="story">
               
            <div class="story__text">
                <h3 class="heading-tertiary u-margin-bottom-small">
                   Enter Info Please
                </h3>
                <input id = "nameform" type="text" style = "display:block; " placeholder="Enter your name">
                <input id = "bet" type="number" style = "display:block; margin-top:3%;" placeholder="Place Bet">
            </div>
            </div>
            </div>
            <div class="u-center-text u-margin-top-big"> <a id = "sub" href="#" class="btn btn--white" > Submit! </a>
                </div>
</section>



<script type="text/javascript" src="https://code.jquery.com/jquery-1.4.3.min.js"></script>
<script type="text/javascript" src="https://cdn.pubnub.com/sdk/javascript/pubnub.4.0.11.min.js"></script>
<script>
//ADD ?title="he"&blah="dwada" to end of things
const urlParams = new URLSearchParams(window.location.search);
iter = urlParams.get('i');
currBet=urlParams.get('x');

if(currBet == null){
    currBetnum = 0;
}else{
    currBetnum = parseInt(currBet);
}
i = parseInt(iter);
if(iter==null){
    iter = "1";
    console.log(iter);
    i=0;

} 
$("#rd").text("Round "+iter);
i = parseInt(iter)-1; 
pubnub = new PubNub({ publishKey : 'pub-c-aabc5896-0d69-48a0-a1c4-8b50df84e72d', 
            subscribeKey : 'sub-c-54dd73f4-e7a2-11e8-91a4-7e00ddddd7aa', uuid: 'daa' }); //keys UUID IS IMPORTANT NOW
function calcBet(bet){
    var res =  Math.floor(Math.random() * (3) + 1);
    console.log(res);
    if(res==2){
        return bet * 2.5;
    }else{
        return 0;
    }

}
$("#sub").click(function(){
    console.log("hello");
    var name = document.getElementById("nameform").value;
    var betNum = document.getElementById("bet").value;
    var resultVal = calcBet(betNum);
    var monLeft = 100-betNum+resultVal;
    currBetnum+=monLeft;
    console.log(resultVal);
    var str = name + " Bet: "+ String(betNum) + " amount: "+String(monLeft);
    console.log(str);
    i++;
    pubnub.publish({channel : "behave", message : str}); //send the message to pubnub
    append = "?i="+String(i)+"&x="+String(currBetnum);
    lin = "https://ting-kerbell.github.io/BehavioralEconExp/dex.html" + append;
    if(i%2==0){
        lin = "https://ting-kerbell.github.io/BehavioralEconExp/inter.html" + append;
    }

    location.replace(lin);
})

</script>
</body>


